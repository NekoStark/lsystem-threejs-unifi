<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8>
  <title>L-System Demo</title>
  <link href="css/main.css" rel="stylesheet">
</head>
<body>
  <div id="control-panel">
    <select id="preset" onchange="selectPreset();">
      <option value="Example A">Example A</option>
      <option value="Example B">Example B</option>
      <option value="Example C">Example C</option>
      <option value="Example D">Example D</option>
      <option value="Example E">Example E</option>
      <option value="Example F">Example F</option>
      <option value="Example G">Example G</option>
      <option value="Example S">Example S</option>
    </select><br /><br />
    <form style="visibility: hidden; display:none;">
      Axiom: <input id="axiom" name="axiom" type="text" value="F"></input><br/>
      Rules: <textarea id="rules" name="rules">F=F[+F]F[-F]F</textarea><br/>
      Iterations: <input id="iterations" name="iterations" type="number" value="5"></input><br/>
      Delta: <input id="delta" name="delta" type="number" value="30"></input><br/>
      Branch Length: <input id="branchLength" name="branchLength" type="number" value="3"></input><br/>
      Branch Radius: <input id="branchRadius" name="branchRadius" type="number" value="1"></input><br/>
    </form>
    <a onclick="render()">Render</a>
  </div>
  <div id="canvas-div"></div>
  <script src="js/lib/jquery.js"></script>
  <script src="js/lib/three.js"></script>
  <script src="js/class/OrbitControls.js"></script>
  <script src="js/class/Rewriter.js"></script>
  <script src="js/class/Params.js"></script>
  <script src="js/class/TreeBuilder.js"></script>
  <script src="js/class/Renderer.js"></script>

  <script>
  var renderer = new Renderer();
  var rules, params, tree;
  initParamsAndRules();
  render();

  function initParamsAndRules() {
    params = new Params($("#axiom").val(), $("#iterations").val(),
                        $("#delta").val(), $("#branchLength").val(),
                        $("#branchRadius").val());
    rules = parseRules($("#rules").val());
  }

  function render() {
    renderer.scene.remove(tree);

    var rewriter = new Rewriter(rules);
    var string = rewriter.rewrite(params);
    tree = new TreeBuilder(string, params).build();

    setTimeout(function(){renderer.scene.add(tree)}, 500);
  }

  function parseRules(rules) {
    var result = {};
    rules.split("\n").forEach(function(a) {
      var line = a.split("=");
      result[line[0]] = line[1];
    });

    return result;
  }

  function selectPreset() {
    var preset = $("#preset").val();
    if(preset == "Example A") {
      params = new Params("F", 5, 25.7);
      rules = { "F" : "F[+F]F[-F]F" };
    }
    if(preset == "Example B") {
      params = new Params("F", 5, 20);
      rules = { "F" : "F[+F]F[-F][F]" };
    }
    if(preset == "Example C") {
      params = new Params("F", 4, 22.5);
      rules = { "F" : "FF-[-F+F+F]+[+F-F-F]" };
    }
    if(preset == "Example D") {
      params = new Params("X", 7, 20);
      rules = { "X" : "F[+X]F[-X]+X", "F" : "FF"  };
    }
    if(preset == "Example E") {
      params = new Params("X", 7, 25.7);
      rules = { "X" : "F[+X][-X]FX", "F" : "FF"  };
    }
    if(preset == "Example F") {
      params = new Params("X", 5, 22.5);
      rules = { "X" : "F-[[X]+X]+F[+FX]-X", "F" : "FF"  };
    }
    if(preset == "Example G") {
      params = new Params("FFFFFA", 4, 25);
      rules = { "A" : "F[++A]X[--A]^^^A" };
    }
    if(preset == "Example S") {
      params = new Params("F", 5, 25);
      rules = { "F" : [ "F[+F]F[-F]F", "F[+F]F", "F[-F]F"] };
    }
  }
  </script>
</body>
</html>
